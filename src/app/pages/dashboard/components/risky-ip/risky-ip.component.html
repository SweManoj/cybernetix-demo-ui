<div class="custom-container">

    <ng-container>
        <div class="risky-user-container">
            <div class="risky-user-header">
                <div class="row m-auto" style="background: #2C4255;">
                    <div class="col-md-2" style="text-align: center;background: #041421;">
                        <img  class="profile-image mt-4"
                            src='./../../../../../assets/images/dashboard_icons/Ip@2x.png' style="width: 4rem;"/>
                        <div class="user-info m-t-sm">
                            <span style="color:#D3D3D3;size:26px;font-weight: 600">{{ipDetails.entityId}}</span>
                            <p></p>
                        </div>
                    </div>
                    
                    <div class="col-md-8 mt-1 d-flex initialPadding">
                        <div class="col-md-3" style="text-align: center;">
                            <div class="info m-t-sm">
                                <span style="color:#a0a0a0;size:30px;font-weight: 500">Last Seen Timestamp</span>
                                <p></p>
                            </div>
                            <div class="user-info m-t-sm">
                                <span style="color:#D3D3D3;size:30px;">{{ipDetails.lastSeenTime | date : 'dd/mm/yyyy HH:mm:ss'}}</span>
                                <p></p>
                            </div>
                        </div>
                        <div class="col-md-3" style="text-align: center;">
                            <div class="info m-t-sm">
                                <span style="color:#a0a0a0;size:30px;font-weight: 500">First Seen Timestamp</span>
                                <p></p>
                            </div>
                            <div class="user-info m-t-sm">
                                <span style="color:#D3D3D3;size:30px;">{{ipDetails.firstSeenTime | date : 'dd/mm/yyyy HH:mm:ss'}}</span>
                                <p></p>
                            </div>
                        </div>
                        <div class="col-md-3" style="text-align: center;">
                            <div class="info m-t-sm">
                                <span style="color:#a0a0a0;size:30px;font-weight: 500">Location</span>
                                <p></p>
                            </div>
                            <div class="user-info m-t-sm">
                                <span style="color:#D3D3D3;size:30px;">{{ipDetails.location}}</span>
                                <p></p>
                            </div>
                        </div>
                        <div class="col-md-3"  style="text-align: center;">
                            <div class="info m-t-sm">
                                <span style="color:#a0a0a0;size:30px;font-weight: 500">Peers</span>
                                <p></p>
                            </div>
                            <div class="user-info m-t-sm">
                                <span style="color:#D3D3D3;size:30px;">{{ipDetails.peers}}</span>
                                <p></p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2" style="text-align: center;background: #041421;">
                        <p [ngStyle]="{'color':getRiskScoreColor(ipDetails.riskScore)}" class="rscore">
                             {{ipDetails.riskScore}}
                        </p>
                        <div class="user-info m-t-sm">
                            <span class="riskscore">Risk Score</span>
                            <p></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </ng-container>

    <!--line chart -->
    <div class="container-fluid chartBg pb-4">
        <div class="row pr-3 pl-3 pb-3" style="height: 64vh;overflow:hidden;">
            <div #lineChartDiv id="lineChartDiv" class="mt-3"></div>
        </div>
    </div>

    <ng-container  *ngFor="let policyViolation of policyViolations">
        <div class="risky-user-violations container-fluid initialPadding mt-3 mb-4" *ngIf="selectedView === 'timeline'">
            <div class="risk-date-stamp">
                <span>{{policyViolation.violationEventDate | date: 'dd MMM yyyy'}}</span>
            </div>
            <div class="row initialPadding" *ngFor="let timeLine of policyViolation.timeLines">
                <div class="col-md-12 d-flex">
                    <div class="risk-time-stamp">
                        <span>{{timeLine.violationEventTime | date : 'hh:mm'}}</span>
                    </div>

                    <div class="risky-separator mt-1">
                        <span class="risk-dot rounded-circle">&nbsp;</span>
                    </div>

                    <div class="violationTitle">
                        <div class="row mt-1 mb-2 ml-3 mr-1">
                            <div class="col-sm-12">
                                <span class="pointerCursor" (click)="timeLine.accord = !timeLine.accord">
                                    &emsp;<i *ngIf="timeLine.accord" class="fa fa-angle-up"></i> <i *ngIf="!timeLine.accord"
                                                                                                    class="fa fa-angle-down"></i>
                                </span>
                                <span class="pointerCursor pvValue"
                                      (click)="timeLine.accord = !timeLine.accord">PV {{timeLine.ruleId}}</span>
                                <span class="pointerCursor pvText" (click)="timeLine.accord = !timeLine.accord">
                                    {{timeLine.ruleName}}</span>

                                <!-- <span (click)="open(item.ruleInfo.ruleid, item.userId,item.isotimestamp)"
                                      class="risk-score mr-5">{{item.riskScore}}</span>
 -->

                                <span
                                    class="risk-score mr-5">{{timeLine.noOfEvents}}</span>
                                <span ngbDropdown placement="bottom-right" class="float-right mt-1" *ngIf="timeLine.accord">
                                    <button class="btn btn-sm greyBackground" id="dropdownBasic1" ngbDropdownToggle>
                                        Actions
                                    </button>
                                    <div class="greyBackground actionDropDown" ngbDropdownMenu
                                         aria-labelledby="dropdownBasic1">
                                        <button ngbDropdownItem class="greyBackground">
                                            Investigate
                                        </button>
                                        <button ngbDropdownItem class="greyBackground" (click) = "createIncident(timeLine.lastViolationId)">
                                            Create an Incident
                                        </button>
                                        <button ngbDropdownItem class="greyBackground">
                                            Perform Remediation
                                        </button>
                                        <button [routerLink]="['/policyViolationSummary', timeLine.lastViolationId]" ngbDropdownItem class="greyBackground">
                                            View Summary
                                        </button>
                                    </div>
                                </span>
                            </div>
                        </div>

                        <div class="row col-md-12 violationInfo " *ngIf="timeLine.accord">
                            <div class="mt-3 d-flex mb-3">
                                <div class="col-md-3 riskAccordBorder">
                                    <dl>
                                        <dt><i class="fa fa-caret-right"></i>&nbsp;&nbsp;Description</dt>
                                        <dd class="mt-2">{{timeLine.ruleDescription}}</dd>
                                    </dl>
                                </div>

                                <div class="col-5 col-sm-5 riskAccordBorder">
                                    <dl>
                                        <dt><i class="fa fa-caret-right"></i>&nbsp;&nbsp;Threat Categorization</dt>
                                    </dl>

                                    <div class="ml-4">
                                        <div class="row mt-1 details">
                                            <div class="col-md-5">
                                                Kill Chain
                                            </div>
                                            <b>&nbsp;:&nbsp;</b>
                                            <div class="col-md-6">
                                                {{timeLine.killChain}}
                                            </div>
                                        </div>
                                        <div class="row mt-1 details">
                                            <div class="col-md-5">
                                                Threat Category
                                            </div>
                                            <b>&nbsp;:&nbsp;</b>
                                            <div class="col-md-6">
                                                {{timeLine.threatCategory}}
                                            </div>
                                        </div>
                                        <div class="row mt-1 details">
                                            <div class="col-md-5">
                                                Sub Category
                                            </div>
                                            <b>&nbsp;:&nbsp;</b>
                                            <div class="col-md-6">
                                                {{timeLine.subCategory}}
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-4 col-sm-4">
                                    <dl>
                                        <dt><i class="fa fa-caret-right"></i>&nbsp;&nbsp;Additional Info</dt>
                                    </dl>
                                    <div class="ml-4">
                                        <!--  <div class="row mt-1 details" *ngFor="let dummyData of dummyDatas">
                                              <div class="col-md-6">
                                                  {{dummyData.title}}
                                              </div>
                                              <b>&nbsp;:&nbsp;</b>
                                              <div class="col-md-5">
                                                  {{dummyData.value}}
                                              </div>
                                          </div>-->
                                        <div class="row mt-1 details">
                                            <div class="col-md-6">
                                                Affected Entity
                                            </div>
                                            <b>&nbsp;:&nbsp;</b>
                                            <div class="col-md-5">
                                                {{policyViolation.entityId}}
                                            </div>
                                        </div>
                                        <div class="row mt-1 details">
                                            <div class="col-md-6">
                                                Locations
                                            </div>
                                            <b>&nbsp;:&nbsp;</b>
                                            <div class="col-md-5">
                                                {{policyViolation.location}}
                                            </div>
                                        </div>
                                        <div class="row mt-1 details">
                                            <div class="col-md-6">
                                                Status
                                            </div>
                                            <b>&nbsp;:&nbsp;</b>
                                            <div class="col-md-5">
                                                {{timeLine.status}}
                                            </div>
                                        </div>
                                        <div class="row mt-1 details">
                                            <div class="col-md-6">
                                                Resources
                                            </div>
                                            <b>&nbsp;:&nbsp;</b>
                                            <div class="col-md-5">
                                                {{timeLine.resource}}
                                            </div>
                                        </div>
                                        <div class="row mt-1 details">
                                            <div class="col-md-6">
                                                Indicators
                                            </div>
                                            <b>&nbsp;:&nbsp;</b>
                                            <div class="col-md-5">
                                                {{timeLine.ruleIndicators}}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </ng-container>

</div>
